language: rust
sudo: required
dist: trusty
rust:
  - nightly
env:
  global:
    - CPUCOUNT=4

# LLVM takes awhile to check out and otherwise we'll manage the submodules in
# our configure script, so disable auto submodule management.
git:
  submodules: false

before_install:
  - echo 0 | sudo tee /proc/sys/net/ipv6/conf/lo/disable_ipv6
  - echo 'deb http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.7 main' | sudo tee -a /etc/apt/sources.list
  - echo 'deb-src http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.7 main' | sudo tee -a /etc/apt/sources.list
  - sudo apt-get -y update
  - sudo apt-get -y --force-yes install curl make g++ python2.7 git zlib1g-dev libedit-dev llvm-3.7-tools
  - git submodule update --init -- src/compiler-rt src/libbacktrace src/jemalloc src/rt/hoedown

script:
  - . rbuild
  - rbuild_llvm_config /usr/lib/llvm-3.7/bin/llvm-config
  - rbuild_host x86_64-unknown-linux-gnu
  - rbuild std -v
  - rbuild_cargo build -p test -v
  - rbuild_test -v

# Real testing happens on http://buildbot.rust-lang.org/
#
# See https://github.com/rust-lang/rust-buildbot
#     CONTRIBUTING.md#pull-requests
